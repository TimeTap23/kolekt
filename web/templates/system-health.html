<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Health - Kolekt</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css?v=2.4.2">
    <link rel="stylesheet" href="/static/css/dashboard.css?v=2.3.0">
    
    <style>
        /* Refined Kolekt Design System */
        :root {
            --kolekt-purple: #7A3FFF;
            --kolekt-magenta: #E940A4;
            --kolekt-orange: #FF6A3D;
            --kolekt-gold: #FFB443;
            --kolekt-gradient: linear-gradient(135deg, #7A3FFF 0%, #E940A4 50%, #FF6A3D 100%);
            --kolekt-radial: radial-gradient(circle at center, #7A3FFF 0%, #E940A4 40%, #FF6A3D 75%, #FFB443 100%);
            --kolekt-glow: rgba(122, 63, 255, 0.3);
            --bg-dark: #0f0f23;
            --bg-card: #1a1a2e;
            --bg-card-hover: #252542;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --text-muted: #6b7280;
            --border-color: #2d2d44;
            --status-healthy: #10b981;
            --status-warning: #f59e0b;
            --status-critical: #ef4444;
        }

        body {
            background: var(--bg-dark) !important;
            color: var(--text-primary);
        }

        .health-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .health-header {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .health-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .health-subtitle {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .overall-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .status-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--status-healthy);
            animation: pulse 2s infinite;
        }

        .status-indicator.warning {
            background: var(--status-warning);
        }

        .status-indicator.critical {
            background: var(--status-critical);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--kolekt-gradient);
        }

        .metric-card:hover {
            border-color: var(--kolekt-purple);
            transform: translateY(-2px);
        }

        .metric-card.critical {
            border-color: var(--status-critical);
        }

        .metric-card.warning {
            border-color: var(--status-warning);
        }

        .metric-card.healthy {
            border-color: var(--status-healthy);
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0;
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--kolekt-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0.5rem 0;
        }

        .metric-subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .trend-up {
            color: var(--status-healthy);
        }

        .trend-down {
            color: var(--status-critical);
        }

        .trend-stable {
            color: var(--text-muted);
        }
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .health-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        .health-card:hover {
            border-color: var(--kolekt-purple);
            transform: translateY(-2px);
        }

        .health-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .health-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .health-card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--kolekt-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .metric-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .metric-value.healthy {
            color: var(--status-healthy);
        }

        .metric-value.warning {
            color: var(--status-warning);
        }

        .metric-value.critical {
            color: var(--status-critical);
        }

        .alerts-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .alerts-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .alerts-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: var(--bg-card-hover);
            border-left: 4px solid var(--status-warning);
        }

        .alert-item.critical {
            border-left-color: var(--status-critical);
        }

        .alert-item.resolved {
            border-left-color: var(--status-healthy);
            opacity: 0.7;
        }

        .alert-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--kolekt-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .alert-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .alert-time {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .performance-chart {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-placeholder {
            height: 300px;
            background: var(--bg-card-hover);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            grid-column: span 2;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--kolekt-gradient);
        }

        .chart-container:hover {
            border-color: var(--kolekt-purple);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-icon {
            width: 24px;
            height: 24px;
            background: var(--kolekt-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .chart-btn {
            padding: 0.25rem 0.75rem;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .chart-btn.active {
            background: var(--kolekt-purple);
            color: white;
            border-color: var(--kolekt-purple);
        }

        .chart-btn:hover {
            border-color: var(--kolekt-purple);
            color: var(--text-primary);
        }

        .alerts-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .alert-item {
            background: var(--bg-card-hover);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
            position: relative;
        }

        .alert-item.critical {
            border-left: 4px solid var(--status-critical);
        }

        .alert-item.warning {
            border-left: 4px solid var(--status-warning);
        }

        .alert-item.info {
            border-left: 4px solid var(--kolekt-purple);
        }

        .alert-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .alert-severity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .severity-critical {
            color: var(--status-critical);
        }

        .severity-warning {
            color: var(--status-warning);
        }

        .severity-info {
            color: var(--kolekt-purple);
        }

        .alert-message {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .alert-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .alert-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .alert-btn {
            padding: 0.25rem 0.75rem;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .alert-btn:hover {
            border-color: var(--kolekt-purple);
            color: var(--text-primary);
        }

        .recommendations-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .recommendation-item {
            background: var(--bg-card-hover);
            border-left: 3px solid var(--kolekt-purple);
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0 4px 4px 0;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--kolekt-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid #dc3545;
            border-radius: 8px;
            padding: 1rem;
            color: #dc3545;
            margin: 1rem 0;
        }

        .success-message {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 1rem;
            color: #28a745;
            margin: 1rem 0;
        }

        .refresh-btn {
            background: var(--kolekt-gradient);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(122, 63, 255, 0.3);
        }

        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .auto-refresh input[type="checkbox"] {
            accent-color: var(--kolekt-purple);
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .health-container {
                padding: 1rem;
            }
            
            .health-header {
                padding: 1.5rem;
            }
            
            .health-title {
                font-size: 1.5rem;
            }
            
            .health-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .health-card {
                padding: 1rem;
            }
            
            .metric-row {
                padding: 0.5rem 0;
            }
            
            .metric-value {
                font-size: 1.25rem;
            }
            
            .alerts-panel {
                padding: 1rem;
            }
            
            .alert-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .performance-chart {
                padding: 1rem;
            }
            
            .chart-placeholder {
                height: 200px;
            }
        }

        @media (max-width: 480px) {
            .health-container {
                padding: 0.5rem;
            }
            
            .health-header {
                padding: 1rem;
            }
            
            .health-title {
                font-size: 1.25rem;
            }
            
            .health-card {
                padding: 0.75rem;
            }
            
            .metric-value {
                font-size: 1.1rem;
            }
            
            .chart-placeholder {
                height: 150px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo">
                    <img src="/static/images/Kolekt_icon.png" alt="Kolekt" class="logo-img">
                </div>
            </div>
            
            <nav class="header-nav">
                <a href="/dashboard" class="nav-link">Dashboard</a>
                <a href="/content-creator" class="nav-link">Content Creator</a>
                <a href="/analytics" class="nav-link">Analytics</a>
                <a href="/team-management" class="nav-link">Team</a>
                <a href="/system-health" class="nav-link active">System Health</a>
            </nav>
            
            <div class="header-actions">
                <div class="user-menu">
                    <button class="user-menu-btn" onclick="toggleUserMenu()">
                        <img src="/static/images/avatar.png" alt="User Avatar" class="user-avatar">
                        <span class="user-name">Admin</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="/profile" class="dropdown-item">Profile</a>
                        <a href="/settings" class="dropdown-item">Settings</a>
                        <a href="/admin" class="dropdown-item">Admin Panel</a>
                        <hr class="dropdown-divider">
                        <a href="/logout" class="dropdown-item">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="health-container">
        <!-- Health Header -->
        <div class="health-header">
            <h1 class="health-title">System Health Dashboard</h1>
            <p class="health-subtitle">Monitor system performance, uptime, and critical metrics</p>
            
            <div class="overall-status">
                <div class="status-indicator" id="overallStatus"></div>
                <span id="statusText">All systems operational</span>
            </div>
            
            <div style="display: flex; gap: 1rem; align-items: center;">
                <button class="refresh-btn" onclick="refreshHealthData()">
                    🔄 Refresh Data
                </button>
                <div class="auto-refresh">
                    <input type="checkbox" id="autoRefresh" checked>
                    <label for="autoRefresh">Auto-refresh every 30s</label>
                </div>
            </div>
        </div>

        <!-- Enhanced Metrics Grid -->
        <div class="metrics-grid">
            <!-- CPU Usage -->
            <div class="metric-card" id="cpuCard">
                <div class="metric-header">
                    <h3 class="metric-title">CPU Usage</h3>
                    <div class="metric-icon">🖥️</div>
                </div>
                <div class="metric-value" id="cpuUsage">23%</div>
                <div class="metric-subtitle">8 cores @ 2.4 GHz</div>
                <div class="metric-trend trend-stable">
                    <span>↔</span>
                    <span>Stable</span>
                </div>
            </div>

            <!-- Memory Usage -->
            <div class="metric-card" id="memoryCard">
                <div class="metric-header">
                    <h3 class="metric-title">Memory Usage</h3>
                    <div class="metric-icon">💾</div>
                </div>
                <div class="metric-value" id="memoryUsage">67%</div>
                <div class="metric-subtitle">5.2 GB / 8 GB available</div>
                <div class="metric-trend trend-stable">
                    <span>↔</span>
                    <span>Stable</span>
                </div>
            </div>

            <!-- Disk Usage -->
            <div class="metric-card" id="diskCard">
                <div class="metric-header">
                    <h3 class="metric-title">Disk Usage</h3>
                    <div class="metric-icon">💿</div>
                </div>
                <div class="metric-value" id="diskUsage">45%</div>
                <div class="metric-subtitle">45 GB / 100 GB used</div>
                <div class="metric-trend trend-up">
                    <span>↗</span>
                    <span>+2% this week</span>
                </div>
            </div>

            <!-- Network I/O -->
            <div class="metric-card" id="networkCard">
                <div class="metric-header">
                    <h3 class="metric-title">Network I/O</h3>
                    <div class="metric-icon">🌐</div>
                </div>
                <div class="metric-value" id="networkIO">2.3 MB/s</div>
                <div class="metric-subtitle">In: 1.2 MB/s | Out: 1.1 MB/s</div>
                <div class="metric-trend trend-up">
                    <span>↗</span>
                    <span>+15% this hour</span>
                </div>
            </div>

            <!-- Database Health -->
            <div class="metric-card" id="databaseCard">
                <div class="metric-header">
                    <h3 class="metric-title">Database Health</h3>
                    <div class="metric-icon">🗄️</div>
                </div>
                <div class="metric-value" id="dbHealth">Healthy</div>
                <div class="metric-subtitle">12/20 connections active</div>
                <div class="metric-trend trend-stable">
                    <span>↔</span>
                    <span>Response: 45ms</span>
                </div>
            </div>

            <!-- API Performance -->
            <div class="metric-card" id="apiCard">
                <div class="metric-header">
                    <h3 class="metric-title">API Performance</h3>
                    <div class="metric-icon">🔌</div>
                </div>
                <div class="metric-value" id="apiResponseTime">120ms</div>
                <div class="metric-subtitle">156 req/min | 0.2% errors</div>
                <div class="metric-trend trend-stable">
                    <span>↔</span>
                    <span>99.8% uptime</span>
                </div>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="chart-container">
            <div class="chart-title">
                <div class="chart-icon">📈</div>
                System Performance Trends
            </div>
            <div class="chart-controls">
                <button class="chart-btn active" data-chart="cpu">CPU</button>
                <button class="chart-btn" data-chart="memory">Memory</button>
                <button class="chart-btn" data-chart="disk">Disk</button>
                <button class="chart-btn" data-chart="network">Network</button>
            </div>
            <div id="performanceChart" class="chart-placeholder">
                <div class="loading-spinner"></div>
                <span style="margin-left: 0.5rem;">Loading performance data...</span>
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="alerts-section">
            <h3 class="chart-title">
                <div class="chart-icon">🚨</div>
                System Alerts
            </h3>
            <div id="alertsContainer">
                <div class="loading-spinner"></div>
                <span style="margin-left: 0.5rem;">Loading alerts...</span>
            </div>
        </div>

        <!-- Recommendations Section -->
        <div class="recommendations-section">
            <h3 class="chart-title">
                <div class="chart-icon">💡</div>
                System Recommendations
            </h3>
            <div id="recommendationsContainer">
                <div class="loading-spinner"></div>
                <span style="margin-left: 0.5rem;">Loading recommendations...</span>
            </div>
        </div>

            <!-- External Services -->
            <div class="health-card">
                <div class="health-card-header">
                    <h3 class="health-card-title">External Services</h3>
                    <div class="health-card-icon">🌐</div>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Supabase</span>
                    <span class="metric-value healthy" id="supabaseStatus">✅ Online</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">OAuth Providers</span>
                    <span class="metric-value healthy" id="oauthStatus">✅ Online</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Email Service</span>
                    <span class="metric-value healthy" id="emailStatus">✅ Online</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">File Storage</span>
                    <span class="metric-value healthy" id="storageStatus">✅ Online</span>
                </div>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="performance-chart">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Performance Trends (Last 24 Hours)</h3>
            <div class="chart-placeholder">
                📈 Performance chart will be displayed here
                <br>
                <small>Integration with monitoring service coming soon</small>
            </div>
        </div>

        <!-- Alerts Panel -->
        <div class="alerts-panel">
            <div class="alerts-header">
                <h3 class="alerts-title">System Alerts</h3>
                <span style="color: var(--text-secondary); font-size: 0.9rem;">Last updated: <span id="lastUpdated">Just now</span></span>
            </div>
            <div id="alertsList">
                <div class="alert-item">
                    <div class="alert-icon">⚠️</div>
                    <div class="alert-content">
                        <div class="alert-title">High Memory Usage</div>
                        <div class="alert-description">Memory usage has increased to 85% in the last 10 minutes</div>
                    </div>
                    <div class="alert-time">2 min ago</div>
                </div>
                <div class="alert-item resolved">
                    <div class="alert-icon">✅</div>
                    <div class="alert-content">
                        <div class="alert-title">Database Connection Restored</div>
                        <div class="alert-description">Database connection pool has been restored to normal levels</div>
                    </div>
                    <div class="alert-time">15 min ago</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        class SystemHealthMonitor {
            constructor() {
                this.autoRefreshInterval = null;
                this.init();
            }

            init() {
                this.loadEnhancedHealthData();
                this.setupAutoRefresh();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('autoRefresh').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.startAutoRefresh();
                    } else {
                        this.stopAutoRefresh();
                    }
                });
            }

            async loadHealthData() {
                try {
                    const response = await fetch('/api/v1/system/health');
                    if (response.ok) {
                        const data = await response.json();
                        this.updateHealthMetrics(data);
                    } else {
                        this.updateHealthMetrics(this.getMockData());
                    }
                } catch (error) {
                    console.error('Error loading health data:', error);
                    this.updateHealthMetrics(this.getMockData());
                }
            }

            updateHealthMetrics(data) {
                // Update overall status
                const overallStatus = document.getElementById('overallStatus');
                const statusText = document.getElementById('statusText');
                
                if (data.overall_status === 'healthy') {
                    overallStatus.className = 'status-indicator';
                    statusText.textContent = 'All systems operational';
                } else if (data.overall_status === 'warning') {
                    overallStatus.className = 'status-indicator warning';
                    statusText.textContent = 'Some systems showing warnings';
                } else {
                    overallStatus.className = 'status-indicator critical';
                    statusText.textContent = 'Critical issues detected';
                }

                // Update metrics
                if (data.server) {
                    document.getElementById('cpuUsage').textContent = data.server.cpu + '%';
                    document.getElementById('memoryUsage').textContent = data.server.memory + '%';
                    document.getElementById('diskUsage').textContent = data.server.disk + '%';
                    document.getElementById('networkIO').textContent = data.server.network;
                }

                if (data.database) {
                    document.getElementById('dbConnections').textContent = data.database.connections;
                    document.getElementById('dbResponseTime').textContent = data.database.response_time;
                    document.getElementById('activeQueries').textContent = data.database.active_queries;
                    document.getElementById('dbSize').textContent = data.database.size;
                }

                if (data.api) {
                    document.getElementById('apiResponseTime').textContent = data.api.response_time;
                    document.getElementById('requestsPerMin').textContent = data.api.requests_per_min;
                    document.getElementById('errorRate').textContent = data.api.error_rate;
                    document.getElementById('uptime').textContent = data.api.uptime;
                }

                // Update last updated time
                document.getElementById('lastUpdated').textContent = 'Just now';
                
                // Update charts if data available
                if (data.charts) {
                    this.updateCharts(data.charts);
                }
            }

            updateCharts(chartData) {
                // This would integrate with a charting library like Chart.js
                console.log('Chart data updated:', chartData);
                
                // Guard against missing data
                if (!chartData || !chartData.performanceTrends) {
                    console.warn('No performance chart data available');
                    return;
                }
                
                // TODO: Replace with actual Chart.js integration
                // Example:
                // const ctx = document.getElementById('performanceChart').getContext('2d');
                // new Chart(ctx, {
                //     type: 'line',
                //     data: chartData.performanceTrends,
                //     options: { responsive: true }
                // });
            }

            getMockData() {
                return {
                    overall_status: 'healthy',
                    server: {
                        cpu: Math.floor(Math.random() * 30) + 15,
                        memory: Math.floor(Math.random() * 30) + 50,
                        disk: Math.floor(Math.random() * 20) + 40,
                        network: (Math.random() * 3 + 1).toFixed(1) + ' MB/s'
                    },
                    database: {
                        connections: Math.floor(Math.random() * 8) + 8 + '/20',
                        response_time: Math.floor(Math.random() * 50) + 30 + 'ms',
                        active_queries: Math.floor(Math.random() * 5) + 5,
                        size: (Math.random() * 2 + 2).toFixed(1) + ' GB'
                    },
                    api: {
                        response_time: Math.floor(Math.random() * 100) + 80 + 'ms',
                        requests_per_min: Math.floor(Math.random() * 100) + 100,
                        error_rate: (Math.random() * 0.5).toFixed(1) + '%',
                        uptime: (99.5 + Math.random() * 0.5).toFixed(1) + '%'
                    }
                };
            }

            // Enhanced System Health Methods
            async loadEnhancedHealthData() {
                try {
                    this.showLoading();
                    const response = await fetch('/api/v1/system/health');
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.updateEnhancedMetrics(data);
                        this.updateAlerts(data.alerts || []);
                        this.updateRecommendations(data.recommendations || []);
                        this.updatePerformanceCharts(data);
                    } else {
                        throw new Error('Failed to load health data');
                    }
                } catch (error) {
                    console.error('Error loading enhanced health data:', error);
                    this.showError('Failed to load system health data');
                    this.updateEnhancedMetrics(this.getMockData());
                } finally {
                    this.hideLoading();
                }
            }

            updateEnhancedMetrics(data) {
                // Update overall status
                this.updateOverallStatus(data.overall_status);
                
                // Update system metrics
                if (data.server) {
                    this.updateSystemMetrics(data.server);
                }
                
                if (data.database) {
                    this.updateDatabaseMetrics(data.database);
                }
                
                if (data.api) {
                    this.updateAPIMetrics(data.api);
                }
            }

            updateOverallStatus(status) {
                const overallStatus = document.getElementById('overallStatus');
                const statusText = document.getElementById('statusText');
                
                // Remove existing classes
                overallStatus.className = 'status-indicator';
                
                switch (status) {
                    case 'healthy':
                        statusText.textContent = 'All systems operational';
                        break;
                    case 'warning':
                        overallStatus.classList.add('warning');
                        statusText.textContent = 'Some systems showing warnings';
                        break;
                    case 'critical':
                        overallStatus.classList.add('critical');
                        statusText.textContent = 'Critical issues detected';
                        break;
                    default:
                        statusText.textContent = 'Status unknown';
                }
            }

            updateSystemMetrics(serverData) {
                // Update CPU
                const cpuUsage = document.getElementById('cpuUsage');
                const cpuCard = document.getElementById('cpuCard');
                cpuUsage.textContent = `${serverData.cpu_usage || 0}%`;
                this.updateMetricCardStatus(cpuCard, serverData.cpu_usage || 0, 80, 70);
                
                // Update Memory
                const memoryUsage = document.getElementById('memoryUsage');
                const memoryCard = document.getElementById('memoryCard');
                memoryUsage.textContent = `${serverData.memory_usage || 0}%`;
                this.updateMetricCardStatus(memoryCard, serverData.memory_usage || 0, 85, 75);
                
                // Update Disk
                const diskUsage = document.getElementById('diskUsage');
                const diskCard = document.getElementById('diskCard');
                diskUsage.textContent = `${serverData.disk_usage || 0}%`;
                this.updateMetricCardStatus(diskCard, serverData.disk_usage || 0, 90, 80);
                
                // Update Network
                const networkIO = document.getElementById('networkIO');
                networkIO.textContent = `${serverData.network_io?.bytes_sent || 0} MB/s`;
            }

            updateDatabaseMetrics(dbData) {
                const dbHealth = document.getElementById('dbHealth');
                const databaseCard = document.getElementById('databaseCard');
                
                dbHealth.textContent = dbData.health_status || 'Unknown';
                
                // Update card status based on health
                if (dbData.health_status === 'healthy') {
                    databaseCard.className = 'metric-card healthy';
                } else {
                    databaseCard.className = 'metric-card critical';
                }
            }

            updateAPIMetrics(apiData) {
                const apiResponseTime = document.getElementById('apiResponseTime');
                const apiCard = document.getElementById('apiCard');
                
                apiResponseTime.textContent = apiData.response_time || '0ms';
                
                // Update card status based on response time
                const responseTime = parseFloat(apiData.response_time?.replace('ms', '') || 0);
                this.updateMetricCardStatus(apiCard, responseTime, 2000, 1000, true);
            }

            updateMetricCardStatus(card, value, criticalThreshold, warningThreshold, isLowerBetter = false) {
                // Remove existing status classes
                card.className = 'metric-card';
                
                let status = 'healthy';
                if (isLowerBetter) {
                    if (value > criticalThreshold) status = 'critical';
                    else if (value > warningThreshold) status = 'warning';
                } else {
                    if (value > criticalThreshold) status = 'critical';
                    else if (value > warningThreshold) status = 'warning';
                }
                
                card.classList.add(status);
            }

            updateAlerts(alerts) {
                const container = document.getElementById('alertsContainer');
                
                if (alerts.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No active alerts</p>';
                    return;
                }
                
                const alertsHtml = alerts.map(alert => `
                    <div class="alert-item ${alert.severity}">
                        <div class="alert-header">
                            <div class="alert-severity severity-${alert.severity}">
                                <span>${this.getSeverityIcon(alert.severity)}</span>
                                <span>${alert.severity.toUpperCase()}</span>
                            </div>
                            <button class="alert-btn" onclick="systemHealth.acknowledgeAlert('${alert.id}')">
                                Acknowledge
                            </button>
                        </div>
                        <div class="alert-message">${alert.message}</div>
                        <div class="alert-meta">
                            <span>Metric: ${alert.metric}</span>
                            <span>Value: ${alert.value}</span>
                            <span>Threshold: ${alert.threshold}</span>
                            <span>Time: ${new Date(alert.timestamp).toLocaleString()}</span>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = alertsHtml;
            }

            updateRecommendations(recommendations) {
                const container = document.getElementById('recommendationsContainer');
                
                if (recommendations.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No recommendations available</p>';
                    return;
                }
                
                const recommendationsHtml = recommendations.map(rec => `
                    <div class="recommendation-item">${rec}</div>
                `).join('');
                
                container.innerHTML = recommendationsHtml;
            }

            updatePerformanceCharts(data) {
                // Simple chart rendering (in production, use Chart.js)
                const chartContainer = document.getElementById('performanceChart');
                
                if (data.server) {
                    const chartHtml = `
                        <div style="height: 300px; display: flex; align-items: end; gap: 4px; padding: 1rem;">
                            <div style="
                                background: var(--kolekt-gradient);
                                width: 60px;
                                height: ${(data.server.cpu_usage || 0) * 2}px;
                                border-radius: 4px;
                                position: relative;
                            " title="CPU: ${data.server.cpu_usage || 0}%">
                            </div>
                            <div style="
                                background: var(--kolekt-gradient);
                                width: 60px;
                                height: ${(data.server.memory_usage || 0) * 2}px;
                                border-radius: 4px;
                                position: relative;
                            " title="Memory: ${data.server.memory_usage || 0}%">
                            </div>
                            <div style="
                                background: var(--kolekt-gradient);
                                width: 60px;
                                height: ${(data.server.disk_usage || 0) * 2}px;
                                border-radius: 4px;
                                position: relative;
                            " title="Disk: ${data.server.disk_usage || 0}%">
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">
                            <span>CPU</span>
                            <span>Memory</span>
                            <span>Disk</span>
                        </div>
                    `;
                    
                    chartContainer.innerHTML = chartHtml;
                }
            }

            getSeverityIcon(severity) {
                const icons = {
                    'critical': '🚨',
                    'warning': '⚠️',
                    'info': 'ℹ️'
                };
                return icons[severity] || 'ℹ️';
            }

            async acknowledgeAlert(alertId) {
                try {
                    const response = await fetch(`/api/v1/system/alerts/acknowledge`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ alert_id: alertId })
                    });
                    
                    if (response.ok) {
                        this.showSuccess('Alert acknowledged successfully');
                        this.loadEnhancedHealthData(); // Refresh data
                    } else {
                        throw new Error('Failed to acknowledge alert');
                    }
                } catch (error) {
                    console.error('Error acknowledging alert:', error);
                    this.showError('Failed to acknowledge alert');
                }
            }

            showLoading() {
                document.querySelectorAll('.loading-spinner').forEach(el => {
                    el.style.display = 'block';
                });
            }

            hideLoading() {
                document.querySelectorAll('.loading-spinner').forEach(el => {
                    el.style.display = 'none';
                });
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = message;
                document.querySelector('.health-container').prepend(errorDiv);
                
                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }

            showSuccess(message) {
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.textContent = message;
                document.querySelector('.health-container').prepend(successDiv);
                
                setTimeout(() => {
                    successDiv.remove();
                }, 5000);
            }
                    }
                };
            }

            startAutoRefresh() {
                this.autoRefreshInterval = setInterval(() => {
                    this.loadHealthData();
                }, 30000); // 30 seconds
            }

            stopAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                    this.autoRefreshInterval = null;
                }
            }

            setupAutoRefresh() {
                if (document.getElementById('autoRefresh').checked) {
                    this.startAutoRefresh();
                }
            }
        }

        // Global functions
        function refreshHealthData() {
            if (window.healthMonitor) {
                healthMonitor.loadHealthData();
            }
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('userDropdown');
            const userMenuBtn = document.querySelector('.user-menu-btn');
            
            if (!userMenuBtn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Initialize system health monitor
        let healthMonitor;
        document.addEventListener('DOMContentLoaded', () => {
            healthMonitor = new SystemHealthMonitor();
        });
    </script>
</body>
</html>
